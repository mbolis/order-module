<div data-bind="with: currentPage">
  <!--ko template:{name: template, afterRender: onRender}--><!--/ko-->
  <div data-bind="ifnot: valid">
    <em>Compila le informazioni richieste per procedere.</em>
  </div>
  <!--ko ifnot: $data.isFinal-->
  <div data-bind="if: valid">
    <!--ko with: $root-->
      <button style="float:left" data-bind="visible: !isFirst() && !lock(), click: back">Indietro</button>
      <button style="float:right" data-bind="visible: isLast() && !lock(), click: submit">Invia</button>
      <button style="float:right" data-bind="visible: !isLast(), click: next">Avanti</button>
    <!--/ko-->
  </div>
  <!--/ko-->
</div>
<div style="cursor:wait;z-index:999;position:fixed;top:0;right:0;bottom:0;left:0;display:none;" data-bind="style:{display: lock()?'block':'none'}"></div>
<script type="text/html" id="contactInformation">
  <label for="contatto_nome"><strong>Nome:&nbsp;</strong></label>
  <input type="text" id="contatto_nome" class="om-line-input" data-bind="textInput: cliente.nome">
  <h3>Appartieni a un GAS?<!--/h3-->
    <input type="radio" id="gas_yes" data-bind="checked: isGasMember, checkedValue: true"> <label for="gas_yes">S&Igrave;</label> <!--TODO: data-bind-->
    <input type="radio" id="gas_no" data-bind="checked: isGasMember, checkedValue: false"> <label for="gas_no">NO</label>
  </h3>
  <p>
    <div class="om-gas-info" data-bind="if: isGasMember">
      <label for="gas_id"><strong>Quale?&nbsp;</strong></label>
      <select id="gas_id" data-bind="value: id_gas, options: gasList, optionsValue: 'id', optionsText: 'nome', optionsCaption: ''"></select>
      <div data-bind="if:id_gas">
        <!--ko with: gas-->
          <strong>Zona:</strong> <!--ko text: area--><!--/ko--><br>
          <strong>Referente:</strong> <!--ko text: nome_contatto--><!--/ko-->
        <!--/ko-->
      </div>
    </div>
    <div class="om-no-gas-info" data-bind="if: isGasMember() === false">
      <!--ko with: cliente-->
        <div>
          <label for="contatto_indirizzo"><strong>Indirizzo:</strong></label><br>
          <textarea id="contatto_indirizzo" class="om-txt-info" data-bind="textInput: indirizzo"></textarea>
        </div>
        <div>
          <label for="contatto_telefono"><strong>Telefono:</strong></label><br>
          <input type="text" id="contatto_telefono" data-bind="textInput: telefono">
          <span id="contatto_telefono_error" class="errore" data-bind="visible: !telefonoIsValid()">Il numero di telefono pu&ograve; contenere solo numeri, spazi e trattini</span>
        </div>
      <!--/ko-->
    </div>
  </p>
</script>
<script type="text/html" id="products">
  <h3 data-bind="text: title"></h3>
  <em style="float:right">Attenzione: i prezzi totali indicati sono indicativi.</em>
  <table class="om-product-table">
    <tbody data-bind="foreach: products">
      <tr>
        <td class="om-field-product-name" data-bind="css:{'om-has-reference-page': $data.pagina}">
          <a target="om_ref_page" data-bind="text: nome, attr:{href: $data.pagina || null}"></a>
          <!--ko if:provenienza--> &mdash; <!--ko text: provenienza--><!--/ko--><!--/ko-->
        </td>
        <td class="om-field-unit-price"><!--ko text: prezzoDisplay--><!--/ko--> &euro;/<span class="om-unita-misura" data-bind="text: unitaMisuraAbbr"></span></td>
        <td class="om-field-qty"><input type="text" class="small" data-bind="textInput: qty"><span class="om-unita-misura" data-bind="text: unita_misura_plurale"></span></td>
        <td class="om-field-tot-price" data-bind="html: finalPrice"></td>
      </tr>
    </tbody>
    <tbody>
      <tr>
        <th class="om-label-total" colspan="3">Totale <!--ko text: typology--><!--/ko--></th>
        <td class="om-field-tot-gen-price om-field-tot-price" data-bind="html: subTotal"></td>
      </tr>
      <tr>
        <th class="om-label-total" colspan="3">Totale generale</th>
        <td class="om-field-tot-gen-price om-field-tot-price" data-bind="html: $root.grandTotal"></td>
      </tr>
    </tbody>
  </table>
  <p>
    <em>Note:</em><br>
    <textarea class="om-txt-info" data-bind="textInput: $root.notes"></textarea>
  </p>
</script>
<script type="text/html" id="om_reference_page_hover">
  <div class="om-ref-page-overlay" style="position:absolute">
    <img class="om-ref-page-image">
  </div>
</script>
<script type="text/html" id="summary">
  <form>
    <table class="om-product-table">
      <thead>
        <tr>
          <th colspan="2"></th>
          <th>Q.t&agrave;</th>
          <th>Prezzo</th>
        </tr>
      </thead>
      <tbody data-bind="foreach: typologies">
        <tr>
          <th class="om-head-typology" colspan="4" data-bind="text: title"></th>
        </tr>
        <!--ko foreach: products-->
        <tr>
          <td class="om-field-product-name"><!--ko text: nome--><!--/ko--></td>
          <td class="om-field-unit-price"><!--ko text: prezzoDisplay--><!--/ko--> &euro;/<span class="om-unita-misura" data-bind="text: unitaMisuraAbbr"></span></td>
          <td class="om-field-qty">
            <span data-bind="if: qtyFloat">
              <!--ko text: qty--><!--/ko--> <span class="om-unita-misura" data-bind="text: unita_misura_plurale"></span>
            </span>
          </td>
          <td class="om-field-tot-price" data-bind="html: finalPrice"></td>
        </tr>
        <!--/ko-->
      </tbody>
      <tfoot>
        <tr>
          <th class="om-label-total" colspan="3">Totale &nbsp;</th>
          <td class="om-field-tot-gen-price om-field-tot-price" data-bind="html: totalPrice"></td>
        </tr>
      </tfoot>
    </table>
    <p>
      <em>Note:</em><br>
      <textarea class="om-txt-info" name="note" data-bind="textInput: $root.notes"></textarea>
    </p>
    <h3>I tuoi dati:</h3>
    <p data-bind="with: contacts">
      <strong>Nome: </strong><!--ko text: cliente.nome--><!--/ko--><br>
      <!--ko if: gas-->
        <!--ko with: gas-->
          <strong>GAS: </strong><!--ko text: nome--><!--/ko--><br>
          <strong>Zona: </strong><!--ko text: area--><!--/ko--><br>
          <strong>Referente: </strong><!--ko text: nome_contatto--><!--/ko-->
        <!--/ko-->
      <!--/ko-->
      <!--ko ifnot: gas-->
        <!--ko with: cliente-->
          <strong>Indirizzo: </strong><!--ko text: indirizzo--><!--/ko--><br>
          <strong>Telefono: </strong><!--ko text: telefono--><!--/ko--><br>
        <!--/ko-->
      <!--/ko-->
    </p>
  </form>
</script>
<script type="text/html" id="final">
  <!--ko with: result-->
  <div data-bind="if: status > 0">
    <h3>Il tuo ordine è stato inviato con successo.</h3>
    <p data-bind="template: 'om_message_form_success'"></p>
  </div>
  <div data-bind="if: status < 0">
    <h3>Non è stato possibile inviare il tuo ordine!</h3>
    <p data-bind="if: status === -1">
      <strong data-bind="template: 'om_message_form_expired'"></strong>
    </p>
    <p data-bind="if: status === -2">
      Si &egrave; verificato un errore nell'inserimento dei dati.<br>
      Si consiglia di provare pi&ugrave; tardi; se non &egrave; possibile riprovare o il problema persiste, contattateci!<br>
      <a href="mailto:info@agricantalupo.it">info@agricantalupo.it</a>
    </p>
    <p data-bind="if: status <= -400 && status > -500">
      Si &egrave; verificato un problema nel modulo d'ordine. Contattateci al pi&ugrave; presto!<br>
      <a href="mailto:info@agricantalupo.it">info@agricantalupo.it</a>
    </p>
    <p data-bind="if: status <= -500">
      Si &egrave; verificato un errore nella gestione della richiesta.<br>
      Si consiglia di provare pi&ugrave; tardi; se non &egrave; possibile riprovare o il problema persiste, contattateci!<br>
      <a href="mailto:info@agricantalupo.it">info@agricantalupo.it</a>
    </p>
  </div>
  <!--/ko-->
</script>
