<div data-bind="with: currentPage">
  <!--ko template: template--><!--/ko-->
  <div data-bind="if: valid">
    <!--ko with: $root-->
    <button style="float:left" data-bind="visible: !isFirst(), click: back">Indietro</button>
    <button style="float:right" data-bind="visible: isLast(), click: submit">Invia</button>
    <button style="float:right" data-bind="visible: !isLast(), click: next">Avanti</button>
    <!--/ko-->
  </div>
</div>
<script type="text/html" id="contactInformation">
  <h2>Appartieni a un GAS?</h2>
  <p>
    <input type="radio" id="gas_yes" data-bind="checked: isGasMember, checkedValue: true"> <label for="gas_yes">S&Igrave;</label> <!--TODO: data-bind-->
    <input type="radio" id="gas_no" data-bind="checked: isGasMember, checkedValue: false"> <label for="gas_no">NO</label>
    <div data-bind="if: isGasMember">
      <h3>Seleziona quale:</h3>
      <select data-bind="value: id_gas, options: gasList, optionsValue: 'id', optionsText: 'nome', optionsCaption: ''"></select>
      <div data-bind="if:id_gas">
        <!--ko with: gas-->
          <strong>GAS:</strong> <!--ko text: nome--><br>
          <strong>Zona:</strong> <!--ko text: area--><br>
          <strong>Nominativo referente:</strong> <!--ko text: nome_contatto-->
        <!--/ko-->
      </div>
    </div>
    <div data-bind="ifnot: isGasMember">
    </div>
  </p>
</script>
<script type="text/html" id="products">
  <h2 data-bind="text: title"></h2>
  <table>
    <tbody data-bind="foreach: products">
      <tr>
        <td data-bind="text: nome"></td>
        <td><!--ko text: prezzo--><!--/ko--> &euro;/<!--ko text: unita_misura--><!--/ko--></td>
        <td><input type="text" class="small" data-bind="textInput: qty"><!--ko text: unita_misura_plurale--><!--/ko--></td>
        <td data-bind="html: finalPrice"></td>
      <tr>
    </tbody>
    <tbody>
      <tr>
        <td colspan="3" style="text-align:right">Totale <!--ko text: typology--><!--/ko-->:</td>
        <td data-bind="html: subTotal"></td>
      </tr>
      <tr>
        <td colspan="3" style="text-align:right">Totale generale:</td>
        <td data-bind="html: $root.grandTotal"></td>
      </tr>
    </tbody>
  </table>
  <p>
    <em>Note:</em><br>
    <textarea data-bind="textInput: $root.notes"></textarea>
  </p>
</script>
<script type="text/html" id="summary">
  <form id="om_order_form" method="POST">
    <input type="hidden" name="action" value="order_form_submit">
    <table data-bind="foreach: typologies">
      <thead>
        <tr>
          <th colspan="4" data-bind="text: title"></th>
        </tr>
      </thead>
      <tbody data-bind="foreach: products">
        <tr>
          <td>
            <!--ko text: nome--><!--/ko-->
          </td>
          <td><!--ko text: prezzo--><!--/ko--> &euro;/<!--ko text: unita_misura--><!--/ko--></td>
          <td>
            <span data-bind="if: qtyFloat">
              <!--ko text: qty--><!--/ko--> <!--ko text: unita_misura_plurale--><!--/ko-->
              <input type="hidden" data-bind="attr: { name: 'products['+$parentContext.$index()+']['+$index()+'][id]' }, value: id">
              <input type="hidden" data-bind="attr: { name: 'products['+$parentContext.$index()+']['+$index()+'][qta]' }, value: qtyFloat">
            </span>
          </td>
          <td data-bind="html: finalPrice"></td>
        </tr>
      <tbody>
    </table>
  </form>
</script>
